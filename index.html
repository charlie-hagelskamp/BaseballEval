<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baseball Player Evaluation System</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #000000, #1a1a1a);
            color: white;
            padding: 25px;
            text-align: center;
            border-bottom: 3px solid #FFD700;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            min-height: 600px;
        }

        .form-section {
            padding: 40px;
            border-bottom: 2px solid #FFD700;
            margin-bottom: 20px;
            order: 1;
        }

        .data-section {
            padding: 40px;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 3px solid #FFD700;
            margin: 20px 0;
            border-radius: 10px;
            order: 2;
        }

        .form-selector {
            margin-bottom: 20px;
        }

        .form-selector label {
            display: block;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
            font-size: 1.1em;
        }

        .form-selector select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            transition: border-color 0.3s ease;
        }

        .form-selector select:focus {
            outline: none;
            border-color: #FFD700;
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
        }

        .evaluation-form {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .evaluation-form.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .player-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #FFD700;
        }

        .player-info h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }

        .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            min-height: 80px;
        }

        .input-group textarea:focus {
            outline: none;
            border-color: #FFD700;
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
        }

        .criteria-section {
            margin-bottom: 30px;
        }

        .criteria-section h3 {
            margin-bottom: 20px;
            color: #333;
            padding-bottom: 10px;
            border-bottom: 2px solid #FFD700;
        }

        .criteria-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            transition: transform 0.2s ease;
        }

        .criteria-item:hover {
            transform: translateX(5px);
            background: #e9ecef;
        }

        .criteria-label {
            font-weight: 500;
            color: #333;
            flex: 1;
        }

        .rating-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .rating-input {
            width: 80px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
        }

        .velocity-input {
            width: 100px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
        }

        .rating-scale {
            font-size: 12px;
            color: #666;
            margin-left: 10px;
        }

        .submit-btn {
            background: linear-gradient(45deg, #000000, #1a1a1a);
            color: white;
            padding: 15px 40px;
            border: 2px solid #FFD700;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.3);
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000000;
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .success-message {
            background: #1a1a1a;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
            border: 2px solid #FFD700;
        }

        .error-message {
            background: #2d1f1f;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
            border: 2px solid #dc3545;
        }

        .data-section h3 {
            margin-bottom: 20px;
            color: white;
            border-bottom: 2px solid #FFD700;
            padding-bottom: 10px;
            background: #000000;
            padding: 10px;
            border-radius: 8px;
        }

        .filter-controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-controls select,
        .filter-controls input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .evaluations-list {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .evaluation-item {
            padding: 15px;
            border-bottom: 1px solid #FFD700;
            background: #1a1a1a;
            transition: background 0.2s;
            color: white;
        }

        .evaluation-item:hover {
            background: #2d2d2d;
        }

        .evaluation-item:last-child {
            border-bottom: none;
        }

        .evaluation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .player-name {
            font-weight: bold;
            font-size: 16px;
            color: white;
        }

        .evaluation-type {
            background: #FFD700;
            color: #000000;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            text-transform: uppercase;
            font-weight: bold;
        }

        .evaluation-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: #ccc;
        }

        .average-score {
            font-weight: bold;
            font-size: 16px;
            color: #FFD700;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .stats-summary {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #FFD700;
            color: white;
        }

        .stats-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .stats-row:last-child {
            border-bottom: none;
        }

        .view-tabs {
            display: flex;
            border-bottom: 2px solid #FFD700;
            margin-bottom: 20px;
        }

        .view-tab {
            padding: 10px 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            margin-right: 5px;
        }

        .view-tab.active {
            background: #000000;
            color: white;
            border: 2px solid #FFD700;
        }

        .view-tab:hover {
            background: #FFD700;
            color: #000000;
        }

        .view-content {
            display: none;
        }

        .view-content.active {
            display: block;
        }

        .player-selector {
            margin-bottom: 20px;
        }

        .player-selector select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            width: 100%;
        }

        .player-profile {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 20px;
            border: 2px solid #FFD700;
            color: white;
        }

        .player-header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(45deg, #000000, #1a1a1a);
            color: white;
            border-radius: 8px;
            border: 2px solid #FFD700;
        }

        .player-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .player-summary {
            font-size: 16px;
        }

        .evaluation-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .evaluation-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            border-left: 4px solid #FFD700;
            margin-bottom: 10px;
        }

        .evaluation-card h4 {
            color: #000000;
            margin-bottom: 8px;
            text-transform: capitalize;
            font-weight: bold;
            font-size: 16px;
        }

        .criteria-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
            font-size: 13px;
            color: #333;
        }

        .criteria-item-small {
            display: flex;
            justify-content: space-between;
            padding: 2px 0;
            color: #333;
        }

        .heatmap-container {
            overflow-x: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .heatmap-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .heatmap-table th,
        .heatmap-table td {
            padding: 8px;
            text-align: center;
            border: 1px solid #ddd;
            font-size: 12px;
        }

        .heatmap-table th {
            background: #000000;
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
            border: 1px solid #FFD700;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.2s;
        }

        .heatmap-table th:hover {
            background: #1a1a1a;
        }

        .heatmap-table th.sortable::after {
            content: ' ‚Üï';
            font-size: 12px;
            opacity: 0.5;
        }

        .heatmap-table th.sort-asc::after {
            content: ' ‚Üë';
            opacity: 1;
        }

        .heatmap-table th.sort-desc::after {
            content: ' ‚Üì';
            opacity: 1;
        }

        .heatmap-table .player-name-col {
            text-align: left;
            font-weight: bold;
            background: #f8f9fa;
            position: sticky;
            left: 0;
            z-index: 5;
        }

        .score-cell {
            font-weight: bold;
            border-radius: 4px;
        }

        .score-excellent { background: #22c55e; color: white; }
        .score-good { background: #84cc16; color: white; }
        .score-average { background: #eab308; color: black; }
        .score-below { background: #f97316; color: white; }
        .score-poor { background: #dc2626; color: white; }
        .score-missing { background: #6b7280; color: white; }

        .overall-avg {
            font-size: 16px;
            font-weight: bold;
            background: #000000;
            border: 2px solid #FFD700;
            color: white;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: white;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: #1a1a1a;
            margin: 10% auto;
            padding: 20px;
            border: 2px solid #FFD700;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            color: white;
            position: relative;
            animation: slideIn 0.3s;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #FFD700;
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
            color: #FFD700;
        }

        .close {
            color: #FFD700;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            color: white;
        }

        .modal-body {
            color: white;
        }

        .eval-detail {
            background: #2d2d2d;
            padding: 10px;
            margin: 8px 0;
            border-radius: 5px;
            border-left: 3px solid #FFD700;
        }

        .eval-detail-header {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .eval-criteria {
            font-size: 14px;
            color: #ccc;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .clickable-cell {
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }

        .clickable-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
        }

        .clickable-name {
            cursor: pointer;
            transition: color 0.2s;
        }

        .clickable-name:hover {
            color: #FFD700 !important;
            text-decoration: underline;
        }

        .setup-notice {
            background: #2d2d1a;
            border: 2px solid #FFD700;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .setup-notice strong {
            display: block;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .form-section {
                border-right: none;
                border-bottom: 1px solid #eee;
                padding: 20px;
            }
            
            .data-section {
                padding: 20px;
            }
            
            .filter-controls {
                flex-direction: column;
            }
            
            .evaluation-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .evaluation-cards {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .evaluation-card {
                padding: 8px;
            }
            
            .form-selector select {
                padding: 10px;
            }
            
            .criteria-section {
                margin-bottom: 20px;
            }
            
            .view-tabs {
                flex-wrap: wrap;
            }
            
            .view-tab {
                padding: 8px 12px;
                font-size: 14px;
            }
            
            .header {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 1.8em;
                margin-bottom: 5px;
            }
            
            .player-info {
                padding: 8px !important;
                margin-bottom: 10px !important;
            }
            
            .player-info h3 {
                font-size: 14px !important;
                margin-bottom: 3px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><img src="logo.png" alt="Falcons Logo" style="height: 40px; vertical-align: middle; margin-right: 10px;"> Northview Falcons Baseball</h1>
        </div>

        <div class="main-content">
            <!-- Form Section -->
            <div class="form-section">
                <div id="setupNotice" class="setup-notice">
                    <strong>‚ö†Ô∏è Setup Required</strong>
                    Replace YOUR_SUPABASE_URL and YOUR_SUPABASE_ANON_KEY in the script below with your actual Supabase credentials.
                </div>

                <!-- Global Evaluator Name -->
                <div class="player-info" style="margin-bottom: 15px; padding: 10px;">
                    <h3 style="margin-bottom: 5px; font-size: 16px;">ü¶Ö Evaluator Name</h3>
                    <div class="input-group" style="margin-bottom: 0;">
                        <input type="text" id="globalEvaluator" placeholder="Your Name (Coach/Evaluator)" required onchange="saveEvaluatorName()">
                    </div>
                </div>

                <div class="form-selector">
                    <label for="evaluationType">Select Evaluation Type:</label>
                    <select id="evaluationType" onchange="handleEvaluationChange()">
                        <option value="">Choose evaluation type...</option>
                        <option value="pitching">Pitching</option>
                        <option value="infield">Infield</option>
                        <option value="outfield">Outfield</option>
                        <option value="batting">Batting</option>
                        <option value="catching">Catching</option>
                        <option value="speed">Speed & Agility</option>
                    </select>
                </div>

                <!-- Pitching Form -->
                <div id="pitching" class="evaluation-form">
                    <div class="player-info">
                        <h3>Player Information</h3>
                        <div class="input-group">
                            <input type="text" id="pitching-name" placeholder="Player Name" required>
                        </div>
                    </div>
                    
                    <div class="criteria-section">
                        <h3>Pitching Evaluation Criteria</h3>
                        <div class="criteria-item">
                            <span class="criteria-label">Velocity (MPH)</span>
                            <div class="rating-group">
                                <input type="number" class="velocity-input" id="pitching-velocity" placeholder="MPH">
                                <span class="rating-scale">Enter velocity in MPH</span>
                            </div>
                        </div>
                        <div class="criteria-item">
                            <span class="criteria-label">Mechanics</span>
                            <div class="rating-group">
                                <input type="number" class="rating-input" min="2" max="8" step="0.5" placeholder="2-8">
                                <span class="rating-scale">2=Poor, 8=Excellent</span>
                            </div>
                        </div>
                        <div class="criteria-item">
                            <span class="criteria-label">Control</span>
                            <div class="rating-group">
                                <input type="number" class="rating-input" min="2" max="8" step="0.5" placeholder="2-8">
                                <span class="rating-scale">Strike zone accuracy</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="criteria-section">
                        <h3>Additional Notes (Optional)</h3>
                        <div class="input-group">
                            <textarea id="pitching-notes" placeholder="Any additional observations, strengths, areas for improvement, etc..."></textarea>
                        </div>
                    </div>
                    
                    <button class="submit-btn" onclick="submitForm('pitching')">Submit Pitching Evaluation</button>
                </div>

                <!-- Infield Form -->
                <div id="infield" class="evaluation-form">
                    <div class="player-info">
                        <h3>Player Information</h3>
                        <div class="input-group">
                            <input type="text" id="infield-name" placeholder="Player Name" required>
                        </div>
                    </div>
                    
                    <div class="criteria-section">
                        <h3>Infield Evaluation Criteria</h3>
                        <div class="criteria-item">
                            <span class="criteria-label">Range/Feet</span>
                            <div class="rating-group">
                                <input type="number" class="rating-input" min="2" max="8" step="0.5" placeholder="2-8">
                                <span class="rating-scale">Ground ball coverage</span>
                            </div>
                        </div>
                        <div class="criteria-item">
                            <span class="criteria-label">Glove</span>
                            <div class="rating-group">
                                <input type="number" class="rating-input" min="2" max="8" step="0.5" placeholder="2-8">
                                <span class="rating-scale">Hands, catching ability</span>
                            </div>
                        </div>
                        <div class="criteria-item">
                            <span class="criteria-label">Mechanics</span>
                            <div class="rating-group">
                                <input type="number" class="rating-input" min="2" max="8" step="0.5" placeholder="2-8">
                                <span class="rating-scale">Fielding technique</span>
                            </div>
                        </div>
                        <div class="criteria-item">
                            <span class="criteria-label">Arm Strength</span>
                            <div class="rating-group">
                                <input type="number" class="rating-input" min="2" max="8" step="0.5" placeholder="2-8">
                                <span class="rating-scale">Throwing velocity</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="criteria-section">
                        <h3>Additional Notes (Optional)</h3>
                        <div class="input-group">
                            <textarea id="infield-notes" placeholder="Any additional observations, strengths, areas for improvement, etc..."></textarea>
                        </div>
                    </div>
                    
                    <button class="submit-btn" onclick="submitForm('infield')">Submit Infield Evaluation</button>
                </div>

                <!-- Outfield Form -->
                <div id="outfield" class="evaluation-form">
                    <div class="player-info">
                        <h3>Player Information</h3>
                        <div class="input-group">
                            <input type="text" id="outfield-name" placeholder="Player Name" required>
                        </div>
                    </div>
                    
                    <div class="criteria-section">
                        <h3>Outfield Evaluation Criteria</h3>
                        <div class="criteria-item">
                            <span class="criteria-label">Range/Speed</span>
                            <div class="rating-group">
                                <input type="number" class="rating-input" min="2" max="8" step="0.5" placeholder="2-8">
                                <span class="rating-scale">Field coverage</span>
                            </div>
                        </div>
                        <div class="criteria-item">
                            <span class="criteria-label">Mechanics</span>
                            <div class="rating-group">
                                <input type="number" class="rating-input" min="2" max="8" step="0.5" placeholder="2-8">
                                <span class="rating-scale">Ball tracking & catching</span>
                            </div>
                        </div>
                        <div class="criteria-item">
                            <span class="criteria-label">Arm Strength</span>
                            <div class="rating-group">
                                <input type="number" class="rating-input" min="2" max="8" step="0.5" placeholder="2-8">
                                <span class="rating-scale">Throwing distance</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="criteria-section">
                        <h3>Additional Notes (Optional)</h3>
                        <div class="input-group">
                            <textarea id="outfield-notes" placeholder="Any additional observations, strengths, areas for improvement, etc..."></textarea>
                        </div>
                    </div>
                    
                    <button class="submit-btn" onclick="submitForm('outfield')">Submit Outfield Evaluation</button>
                </div>

                <!-- Batting Form -->
                <div id="batting" class="evaluation-form">
                    <div class="player-info">
                        <h3>Player Information</h3>
                        <div class="input-group">
                            <input type="text" id="batting-name" placeholder="Player Name" required>
                        </div>
                    </div>
                    
                    <div class="criteria-section">
                        <h3>Batting Evaluation Criteria</h3>
                        <div class="criteria-item">
                            <span class="criteria-label">Mechanics</span>
                            <div class="rating-group">
                                <input type="number" class="rating-input" min="2" max="8" step="0.5" placeholder="2-8">
                                <span class="rating-scale">Swing technique & form</span>
                            </div>
                        </div>
                        <div class="criteria-item">
                            <span class="criteria-label">Contact</span>
                            <div class="rating-group">
                                <input type="number" class="rating-input" min="2" max="8" step="0.5" placeholder="2-8">
                                <span class="rating-scale">Bat-to-ball skills</span>
                            </div>
                        </div>
                        <div class="criteria-item">
                            <span class="criteria-label">Power</span>
                            <div class="rating-group">
                                <input type="number" class="rating-input" min="2" max="8" step="0.5" placeholder="2-8">
                                <span class="rating-scale">Hit distance/exit velocity</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="criteria-section">
                        <h3>Additional Notes (Optional)</h3>
                        <div class="input-group">
                            <textarea id="batting-notes" placeholder="Any additional observations, strengths, areas for improvement, etc..."></textarea>
                        </div>
                    </div>
                    
                    <button class="submit-btn" onclick="submitForm('batting')">Submit Batting Evaluation</button>
                </div>

                <!-- Catching Form -->
                <div id="catching" class="evaluation-form">
                    <div class="player-info">
                        <h3>Player Information</h3>
                        <div class="input-group">
                            <input type="text" id="catching-name" placeholder="Player Name" required>
                        </div>
                    </div>
                    
                    <div class="criteria-section">
                        <h3>Catching Evaluation Criteria</h3>
                        <div class="criteria-item">
                            <span class="criteria-label">Receiving</span>
                            <div class="rating-group">
                                <input type="number" class="rating-input" min="2" max="8" step="0.5" placeholder="2-8">
                                <span class="rating-scale">Framing & catching</span>
                            </div>
                        </div>
                        <div class="criteria-item">
                            <span class="criteria-label">Blocking</span>
                            <div class="rating-group">
                                <input type="number" class="rating-input" min="2" max="8" step="0.5" placeholder="2-8">
                                <span class="rating-scale">Dirt ball skills</span>
                            </div>
                        </div>
                        <div class="criteria-item">
                            <span class="criteria-label">Pop Time</span>
                            <div class="rating-group">
                                <input type="number" class="rating-input" min="2" max="8" step="0.5" placeholder="2-8">
                                <span class="rating-scale">Throwing to 2nd base</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="criteria-section">
                        <h3>Additional Notes (Optional)</h3>
                        <div class="input-group">
                            <textarea id="catching-notes" placeholder="Any additional observations, strengths, areas for improvement, etc..."></textarea>
                        </div>
                    </div>
                    
                    <button class="submit-btn" onclick="submitForm('catching')">Submit Catching Evaluation</button>
                </div>

                <!-- Speed Form -->
                <div id="speed" class="evaluation-form">
                    <div class="player-info">
                        <h3>Player Information</h3>
                        <div class="input-group">
                            <input type="text" id="speed-name" placeholder="Player Name" required>
                        </div>
                    </div>
                    
                    <div class="criteria-section">
                        <h3>Speed Evaluation Criteria</h3>
                        <div class="criteria-item">
                            <span class="criteria-label">60 Time</span>
                            <div class="rating-group">
                                <input type="text" class="velocity-input" id="speed-time" placeholder="7.2">
                                <span class="rating-scale">seconds (e.g. 7.2)</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="criteria-section">
                        <h3>Additional Notes (Optional)</h3>
                        <div class="input-group">
                            <textarea id="speed-notes" placeholder="Any additional observations, strengths, areas for improvement, etc..."></textarea>
                        </div>
                    </div>
                    
                    <button class="submit-btn" onclick="submitForm('speed')">Submit Speed Evaluation</button>
                </div>

                <div id="successMessage" class="success-message"></div>
                <div id="errorMessage" class="error-message"></div>
            </div>

            <!-- Data Viewing Section -->
            <div class="data-section">
                <h3><img src="logo.png" alt="Falcons Logo" style="height: 24px; vertical-align: middle; margin-right: 8px;"> Northview Falcons - Live Player Evaluations</h3>
                
                <div id="statsSection" class="stats-summary" style="display: none;">
                    <h4>Summary Statistics</h4>
                    <div id="statsContent"></div>
                </div>

                <!-- View Tabs -->
                <div class="view-tabs">
                    <button class="view-tab active" onclick="switchView('recent')">Recent Evaluations</button>
                    <button class="view-tab" onclick="switchView('player')">Player Profile</button>
                    <button class="view-tab" onclick="switchView('heatmap')">All Players Heatmap</button>
                </div>

                <!-- Recent Evaluations View -->
                <div id="recentView" class="view-content active">
                    <div class="filter-controls">
                        <select id="typeFilter" onchange="filterEvaluations()">
                            <option value="">All Types</option>
                            <option value="pitching">Pitching</option>
                            <option value="infield">Infield</option>
                            <option value="outfield">Outfield</option>
                            <option value="batting">Batting</option>
                            <option value="catching">Catching</option>
                            <option value="speed">Speed</option>
                        </select>
                        <input type="text" id="playerFilter" placeholder="Search players..." onkeyup="filterEvaluations()">
                        <select id="sortBy" onchange="filterEvaluations()">
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                            <option value="highest">Highest Score</option>
                            <option value="lowest">Lowest Score</option>
                            <option value="name">Player Name</option>
                        </select>
                    </div>

                    <div id="evaluationsList" class="evaluations-list">
                        <div class="loading">Loading evaluations...</div>
                    </div>
                </div>

                <!-- Player Profile View -->
                <div id="playerView" class="view-content">
                    <div class="player-selector">
                        <select id="playerSelect" onchange="loadPlayerProfile()">
                            <option value="">Select a player...</option>
                        </select>
                    </div>
                    <div id="playerProfile" class="player-profile" style="display: none;">
                        <div class="loading">Loading player profile...</div>
                    </div>
                </div>

                <!-- Heatmap View -->
                <div id="heatmapView" class="view-content">
                    <div id="heatmapLegend" class="legend">
                        <!-- Legend will be dynamically updated -->
                    </div>
                    <div class="heatmap-container">
                        <table id="heatmapTable" class="heatmap-table">
                            <thead>
                                <tr>
                                    <th class="player-name-col sortable" onclick="sortHeatmap('name')">Player Name</th>
                                    <th class="sortable" onclick="sortHeatmap('pitching')">Pitching</th>
                                    <th class="sortable" onclick="sortHeatmap('velocity')">Velocity</th>
                                    <th class="sortable" onclick="sortHeatmap('infield')">Infield</th>
                                    <th class="sortable" onclick="sortHeatmap('outfield')">Outfield</th>
                                    <th class="sortable" onclick="sortHeatmap('batting')">Batting</th>
                                    <th class="sortable" onclick="sortHeatmap('catching')">Catching</th>
                                    <th class="sortable" onclick="sortHeatmap('speed')">Speed</th>
                                    <th class="overall-avg sortable" onclick="sortHeatmap('overall')">Overall Avg</th>
                                </tr>
                            </thead>
                            <tbody id="heatmapBody">
                                <tr><td colspan="9" class="loading">Loading heatmap...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Modal for evaluation details -->
                <div id="evaluationModal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title" id="modalTitle">Evaluation Details</div>
                            <span class="close" onclick="closeModal()">&times;</span>
                        </div>
                        <div class="modal-body" id="modalBody">
                            Loading...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // REPLACE THESE WITH YOUR ACTUAL SUPABASE CREDENTIALS
        const SUPABASE_URL = 'https://wlhqhfedrvqlgfjfijuj.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndsaHFoZmVkcnZxbGdmamZpanVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMzNzYyNDQsImV4cCI6MjA2ODk1MjI0NH0.uq2WE2hN9a5vL5fwPRsq3tt3c9DPXr7ubbNDR7HvPO4';

        // Initialize Supabase client
        let supabase;
        let allEvaluations = [];
        let currentEvaluator = '';

        // Save evaluator name to localStorage
        function saveEvaluatorName() {
            const evaluatorInput = document.getElementById('globalEvaluator');
            if (evaluatorInput.value.trim()) {
                currentEvaluator = evaluatorInput.value.trim();
                localStorage.setItem('baseball_evaluator_name', currentEvaluator);
            }
        }

        // Load saved evaluator name
        function loadEvaluatorName() {
            const savedEvaluator = localStorage.getItem('baseball_evaluator_name');
            if (savedEvaluator) {
                currentEvaluator = savedEvaluator;
                document.getElementById('globalEvaluator').value = savedEvaluator;
            }
        }

        function initializeSupabase() {
            if (SUPABASE_URL === 'YOUR_SUPABASE_URL' || SUPABASE_ANON_KEY === 'YOUR_SUPABASE_ANON_KEY') {
                console.warn('Supabase credentials not configured');
                return false;
            }

            try {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                document.getElementById('setupNotice').style.display = 'none';
                return true;
            } catch (error) {
                console.error('Failed to initialize Supabase:', error);
                return false;
            }
        }

        // Form switching functionality
        function handleEvaluationChange() {
            const dropdown = document.getElementById('evaluationType');
            if (!dropdown) return;
            
            const selectedValue = dropdown.value;
            
            // Hide all forms first
            const forms = ['pitching', 'infield', 'outfield', 'batting', 'catching', 'speed'];
            forms.forEach(formId => {
                const form = document.getElementById(formId);
                if (form) {
                    form.style.display = 'none';
                    form.classList.remove('active');
                }
            });
            
            // Show the selected form
            if (selectedValue && selectedValue !== '') {
                const targetForm = document.getElementById(selectedValue);
                if (targetForm) {
                    targetForm.style.display = 'block';
                    targetForm.classList.add('active');
                }
            }
        }

        // Submit form function
        async function submitForm(formType) {
            if (!supabase) {
                showError('Supabase not configured. Please update your credentials.');
                return;
            }

            const form = document.getElementById(formType);
            const nameInput = document.getElementById(formType + '-name');
            const submitBtn = form.querySelector('.submit-btn');
            
            // Validation
            if (!currentEvaluator) {
                alert('Please enter your evaluator name at the top of the form');
                document.getElementById('globalEvaluator').focus();
                return;
            }
            
            if (!nameInput.value.trim()) {
                alert('Please enter player name');
                nameInput.focus();
                return;
            }
            
            // Handle pitching form differently (has velocity field)
            if (formType === 'pitching') {
                const velocityInput = document.getElementById('pitching-velocity');
                const ratingInputs = form.querySelectorAll('.rating-input');
                
                // Check velocity input
                const velocity = parseFloat(velocityInput.value);
                if (!velocity || velocity < 0 || velocity > 120) {
                    alert('Please enter a valid velocity (0-120 MPH)');
                    velocityInput.focus();
                    return;
                }
                
                // Check rating inputs (2-8 scale)
                let allRatingsValid = true;
                const ratings = [];
                const criteriaNames = ['Mechanics', 'Control'];
                
                ratingInputs.forEach((input, index) => {
                    const value = parseFloat(input.value);
                    if (!value || value < 2 || value > 8) {
                        allRatingsValid = false;
                    } else {
                        ratings.push({
                            criteria: criteriaNames[index],
                            rating: value
                        });
                    }
                });
                
                if (!allRatingsValid) {
                    alert('Please fill in all ratings with values between 2-8 (0.5 increments allowed)');
                    return;
                }
                
                // Calculate average score (exclude velocity from average)
                const averageScore = (ratings.reduce((sum, item) => sum + item.rating, 0) / ratings.length).toFixed(2);
                
                // Get notes
                const notesInput = document.getElementById(formType + '-notes');
                const notes = notesInput ? notesInput.value.trim() : '';
                
                // Create evaluation object for pitching
                const evaluation = {
                    player_name: nameInput.value.trim(),
                    evaluator_name: currentEvaluator,
                    evaluation_type: formType,
                    velocity: velocity,
                    ratings: ratings,
                    average_score: parseFloat(averageScore),
                    notes: notes,
                    created_at: new Date().toISOString()
                };
                
                await submitToSupabase(evaluation, formType, form, submitBtn, averageScore);
                
            } else if (formType === 'speed') {
                // Handle speed form (time field instead of ratings)
                const timeInput = document.getElementById('speed-time');
                
                // Check time input
                const time = parseFloat(timeInput.value);
                if (!time || time < 5.0 || time > 12.0) {
                    alert('Please enter a valid 60-yard dash time (5.0-12.0 seconds)');
                    timeInput.focus();
                    return;
                }
                
                // Convert time to score (lower time = higher score)
                // Rough scale: 6.5s = 8, 7.0s = 7, 7.5s = 6, 8.0s = 5, 8.5s = 4, 9.0+ = 3-2
                let score;
                if (time <= 6.5) score = 8;
                else if (time <= 6.8) score = 7.5;
                else if (time <= 7.0) score = 7;
                else if (time <= 7.3) score = 6.5;
                else if (time <= 7.5) score = 6;
                else if (time <= 7.8) score = 5.5;
                else if (time <= 8.0) score = 5;
                else if (time <= 8.5) score = 4;
                else if (time <= 9.0) score = 3;
                else score = 2;
                
                const ratings = [{
                    criteria: '60 Time',
                    rating: score,
                    time: time
                }];
                
                // Get notes
                const notesInput = document.getElementById(formType + '-notes');
                const notes = notesInput ? notesInput.value.trim() : '';
                
                // Create evaluation object for speed
                const evaluation = {
                    player_name: nameInput.value.trim(),
                    evaluator_name: currentEvaluator,
                    evaluation_type: formType,
                    ratings: ratings,
                    average_score: score,
                    notes: notes,
                    created_at: new Date().toISOString()
                };
                
                await submitToSupabase(evaluation, formType, form, submitBtn, score.toFixed(2));
                
            } else {
                // Handle all other forms (2-8 rating scale)
                const ratingInputs = form.querySelectorAll('.rating-input');
                const criteriaNames = getCriteriaNames(formType);
                
                // Check if all ratings are filled
                let allRatingsValid = true;
                const ratings = [];
                ratingInputs.forEach((input, index) => {
                    const value = parseFloat(input.value);
                    if (!value || value < 2 || value > 8) {
                        allRatingsValid = false;
                    } else {
                        ratings.push({
                            criteria: criteriaNames[index],
                            rating: value
                        });
                    }
                });
                
                if (!allRatingsValid) {
                    alert('Please fill in all ratings with values between 2-8 (0.5 increments allowed)');
                    return;
                }
                
                // Calculate average score
                const averageScore = (ratings.reduce((sum, item) => sum + item.rating, 0) / ratings.length).toFixed(2);
                
                // Get notes
                const notesInput = document.getElementById(formType + '-notes');
                const notes = notesInput ? notesInput.value.trim() : '';
                
                // Create evaluation object
                const evaluation = {
                    player_name: nameInput.value.trim(),
                    evaluator_name: currentEvaluator,
                    evaluation_type: formType,
                    ratings: ratings,
                    average_score: parseFloat(averageScore),
                    notes: notes,
                    created_at: new Date().toISOString()
                };
                
                await submitToSupabase(evaluation, formType, form, submitBtn, averageScore);
            }
        }

        function getCriteriaNames(formType) {
            const criteriaMap = {
                infield: ['Range/Feet', 'Glove', 'Mechanics', 'Arm Strength'],
                outfield: ['Range/Speed', 'Mechanics', 'Arm Strength'],
                batting: ['Mechanics', 'Contact', 'Power'],
                catching: ['Receiving', 'Blocking', 'Pop Time'],
                speed: ['60 Time']
            };
            return criteriaMap[formType] || [];
        }

        // Helper function to submit to Supabase
        async function submitToSupabase(evaluation, formType, form, submitBtn, averageScore) {
            // Show loading state
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            
            try {
                const { data, error } = await supabase
                    .from('evaluations')
                    .insert([evaluation])
                    .select();

                if (error) throw error;

                // Show success message
                showSuccess(`${evaluation.player_name}'s ${formType} evaluation submitted successfully! Average Score: ${averageScore}/8`);
                
                // Clear form but keep the same evaluation type selected
                form.querySelectorAll('input').forEach(input => {
                    if (input.type === 'text' || input.type === 'number') {
                        input.value = '';
                    }
                });
                form.querySelectorAll('textarea').forEach(textarea => {
                    textarea.value = '';
                });
                
                // Refresh evaluations list
                loadEvaluations();
                
            } catch (error) {
                console.error('Error submitting evaluation:', error);
                showError('Failed to submit evaluation. Please try again.');
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                submitBtn.textContent = `Submit ${formType.charAt(0).toUpperCase() + formType.slice(1)} Evaluation`;
            }
        }

        // Load evaluations from Supabase
        async function loadEvaluations() {
            if (!supabase) return;

            try {
                const { data, error } = await supabase
                    .from('evaluations')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                allEvaluations = data || [];
                displayEvaluations(allEvaluations);
                updateStats(allEvaluations);
                
                // Update other views if they're currently active
                const activeView = document.querySelector('.view-tab.active').textContent;
                if (activeView.includes('Player')) {
                    populatePlayerSelector();
                } else if (activeView.includes('Heatmap')) {
                    generateHeatmap();
                }

            } catch (error) {
                console.error('Error loading evaluations:', error);
                document.getElementById('evaluationsList').innerHTML = '<div class="loading">Error loading evaluations</div>';
            }
        }

        // Display evaluations in the list
        function displayEvaluations(evaluations) {
            const container = document.getElementById('evaluationsList');
            
            if (evaluations.length === 0) {
                container.innerHTML = '<div class="loading">No evaluations found</div>';
                return;
            }

            const html = evaluations.map(eval => {
                const date = new Date(eval.created_at).toLocaleString();
                const velocityInfo = eval.velocity ? `<br><small>Velocity: ${eval.velocity} MPH</small>` : '';
                
                return `
                    <div class="evaluation-item">
                        <div class="evaluation-header">
                            <span class="player-name">${eval.player_name}</span>
                            <span class="evaluation-type">${eval.evaluation_type}</span>
                        </div>
                        <div class="evaluation-details">
                            <span>${date}${velocityInfo}</span>
                            <span class="average-score">${eval.average_score}/8</span>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
        }

        // Update statistics
        function updateStats(evaluations) {
            if (evaluations.length === 0) {
                document.getElementById('statsSection').style.display = 'none';
                return;
            }

            const stats = {
                total: evaluations.length,
                avgScore: (evaluations.reduce((sum, eval) => sum + eval.average_score, 0) / evaluations.length).toFixed(2),
                byType: {}
            };

            evaluations.forEach(eval => {
                if (!stats.byType[eval.evaluation_type]) {
                    stats.byType[eval.evaluation_type] = { count: 0, totalScore: 0 };
                }
                stats.byType[eval.evaluation_type].count++;
                stats.byType[eval.evaluation_type].totalScore += eval.average_score;
            });

            const statsHtml = `
                <div class="stats-row">
                    <span>Total Evaluations:</span>
                    <span><strong>${stats.total}</strong></span>
                </div>
                <div class="stats-row">
                    <span>Overall Average:</span>
                    <span><strong>${stats.avgScore}/8</strong></span>
                </div>
                ${Object.entries(stats.byType).map(([type, data]) => `
                    <div class="stats-row">
                        <span>${type.charAt(0).toUpperCase() + type.slice(1)}:</span>
                        <span>${data.count} evals (avg: ${(data.totalScore / data.count).toFixed(2)}/8)</span>
                    </div>
                `).join('')}
            `;

            document.getElementById('statsContent').innerHTML = statsHtml;
            document.getElementById('statsSection').style.display = 'block';
        }

        // Filter and sort evaluations
        function filterEvaluations() {
            const typeFilter = document.getElementById('typeFilter').value;
            const playerFilter = document.getElementById('playerFilter').value.toLowerCase();
            const sortBy = document.getElementById('sortBy').value;

            let filtered = allEvaluations.filter(eval => {
                const matchesType = !typeFilter || eval.evaluation_type === typeFilter;
                const matchesPlayer = !playerFilter || eval.player_name.toLowerCase().includes(playerFilter);
                return matchesType && matchesPlayer;
            });

            // Sort evaluations
            filtered.sort((a, b) => {
                switch (sortBy) {
                    case 'oldest':
                        return new Date(a.created_at) - new Date(b.created_at);
                    case 'highest':
                        return b.average_score - a.average_score;
                    case 'lowest':
                        return a.average_score - b.average_score;
                    case 'name':
                        return a.player_name.localeCompare(b.player_name);
                    default: // newest
                        return new Date(b.created_at) - new Date(a.created_at);
                }
            });

            displayEvaluations(filtered);
        }

        // Show success message
        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.innerHTML = message;
            successDiv.style.display = 'block';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 5000);
        }

        // Show error message
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.innerHTML = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // View switching functionality
        function switchView(viewName) {
            // Update tab states
            document.querySelectorAll('.view-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Hide all views
            document.querySelectorAll('.view-content').forEach(view => {
                view.classList.remove('active');
            });

            // Show selected view
            const viewId = viewName + 'View';
            document.getElementById(viewId).classList.add('active');

            // Load data for the view
            if (viewName === 'player') {
                populatePlayerSelector();
            } else if (viewName === 'heatmap') {
                generateHeatmap();
            }
        }

        // Populate player selector dropdown
        function populatePlayerSelector() {
            if (!allEvaluations.length) return;

            const players = [...new Set(allEvaluations.map(eval => eval.player_name))].sort();
            const select = document.getElementById('playerSelect');
            
            select.innerHTML = '<option value="">Select a player...</option>';
            players.forEach(player => {
                const option = document.createElement('option');
                option.value = player;
                option.textContent = player;
                select.appendChild(option);
            });
        }

        // Load individual player profile
        function loadPlayerProfile() {
            const playerName = document.getElementById('playerSelect').value;
            const profileDiv = document.getElementById('playerProfile');
            
            if (!playerName) {
                profileDiv.style.display = 'none';
                return;
            }

            profileDiv.style.display = 'block';
            
            const playerEvaluations = allEvaluations.filter(eval => eval.player_name === playerName);
            
            if (playerEvaluations.length === 0) {
                profileDiv.innerHTML = '<div class="loading">No evaluations found for this player</div>';
                return;
            }

            // Calculate overall stats
            const totalEvals = playerEvaluations.length;
            const overallAvg = (playerEvaluations.reduce((sum, eval) => sum + eval.average_score, 0) / totalEvals).toFixed(2);
            const evalTypes = [...new Set(playerEvaluations.map(eval => eval.evaluation_type))];

            let profileHTML = `
                <div class="player-header">
                    <div class="player-name">${playerName}</div>
                    <div class="player-summary">
                        ${totalEvals} evaluations ‚Ä¢ Overall Average: ${overallAvg}/8 ‚Ä¢ ${evalTypes.length} skill areas
                    </div>
                </div>
                <div class="evaluation-cards">
            `;

            // Group evaluations by type
            const evalsByType = {};
            playerEvaluations.forEach(eval => {
                if (!evalsByType[eval.evaluation_type]) {
                    evalsByType[eval.evaluation_type] = [];
                }
                evalsByType[eval.evaluation_type].push(eval);
            });

            // Create cards for each evaluation type
            Object.entries(evalsByType).forEach(([type, evals]) => {
                const avgScore = (evals.reduce((sum, eval) => sum + eval.average_score, 0) / evals.length).toFixed(2);
                
                profileHTML += `
                    <div class="evaluation-card">
                        <h4>${type} - Average: ${avgScore}/8 (${evals.length} evaluation${evals.length > 1 ? 's' : ''})</h4>
                `;

                // Show all evaluations for this type
                evals.sort((a, b) => new Date(b.created_at) - new Date(a.created_at)).forEach((evaluation, index) => {
                    profileHTML += `
                        <div style="margin-bottom: 15px; padding: 10px; background: ${index % 2 === 0 ? '#f0f0f0' : '#e8e8e8'}; border-radius: 4px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <strong style="color: #000000;">Evaluator: ${evaluation.evaluator_name || 'Unknown'}</strong>
                                <span style="font-size: 12px; color: #666;">${new Date(evaluation.created_at).toLocaleDateString()}</span>
                            </div>
                            <div class="criteria-grid">
                    `;

                    // Show evaluation details
                    if (evaluation.velocity) {
                        profileHTML += `<div class="criteria-item-small"><span>Velocity:</span><span>${evaluation.velocity} MPH</span></div>`;
                    }
                    
                    evaluation.ratings.forEach(rating => {
                        if (rating.time) {
                            profileHTML += `<div class="criteria-item-small"><span>${rating.criteria}:</span><span>${rating.time}s (${rating.rating}/8)</span></div>`;
                        } else {
                            profileHTML += `<div class="criteria-item-small"><span>${rating.criteria}:</span><span>${rating.rating}/8</span></div>`;
                        }
                    });

                    profileHTML += `
                            </div>
                            ${evaluation.notes ? `<div style="margin-top: 8px; padding: 8px; background: #e0e0e0; border-radius: 3px; font-style: italic; color: #000000;"><strong>Notes:</strong> ${evaluation.notes}</div>` : ''}
                            <div style="text-align: right; margin-top: 5px;">
                                <strong style="color: #000000;">Score: ${evaluation.average_score.toFixed(1)}/8</strong>
                            </div>
                        </div>
                    `;
                });

                profileHTML += `</div>`;
            });

            profileHTML += '</div>';
            profileDiv.innerHTML = profileHTML;
        }

        // Global variables for heatmap sorting
        let heatmapData = [];
        let currentSort = { column: null, direction: 'asc' };

        // Sort heatmap by column
        function sortHeatmap(column) {
            // Toggle direction if clicking same column
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'asc';
            }

            // Update header styles
            document.querySelectorAll('.heatmap-table th').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });
            
            const clickedHeader = event.target;
            clickedHeader.classList.add(currentSort.direction === 'asc' ? 'sort-asc' : 'sort-desc');

            // Sort the data
            const sortedData = [...heatmapData].sort((a, b) => {
                let valueA, valueB;
                
                if (column === 'name') {
                    valueA = a.name.toLowerCase();
                    valueB = b.name.toLowerCase();
                    return currentSort.direction === 'asc' ? valueA.localeCompare(valueB) : valueB.localeCompare(valueA);
                } else if (column === 'overall') {
                    valueA = a.overall || 0;
                    valueB = b.overall || 0;
                } else if (column === 'velocity') {
                    valueA = a.velocity || 0;
                    valueB = b.velocity || 0;
                } else {
                    valueA = a.scores[column] || 0;
                    valueB = b.scores[column] || 0;
                }
                
                if (currentSort.direction === 'asc') {
                    return valueA - valueB;
                } else {
                    return valueB - valueA;
                }
            });

            // Recalculate ranges for sorted data
            const scoreRanges = calculateDynamicRanges(sortedData);
            updateLegend(scoreRanges);
            renderHeatmapTable(sortedData, scoreRanges);
        }

        // Render heatmap table
        function renderHeatmapTable(data, scoreRanges) {
            const evalTypes = ['pitching', 'infield', 'outfield', 'batting', 'catching', 'speed'];
            
            let heatmapHTML = '';
            data.forEach(player => {
                let row = `<tr><td class="player-name-col clickable-name" onclick="openPlayerProfile('${player.name}')">${player.name}</td>`;
                
                // Add pitching score
                const pitchingScore = player.scores['pitching'];
                if (pitchingScore > 0) {
                    const cellClass = getScoreClass(pitchingScore, scoreRanges);
                    row += `<td class="score-cell ${cellClass} clickable-cell" onclick="openEvaluationModal('${player.name}', 'pitching')">${pitchingScore.toFixed(1)}</td>`;
                } else {
                    row += `<td class="score-cell score-missing">-</td>`;
                }
                
                // Add velocity column
                if (player.velocity > 0) {
                    const velocityClass = getVelocityClass(player.velocity, scoreRanges);
                    row += `<td class="score-cell ${velocityClass}">${player.velocity.toFixed(1)} MPH</td>`;
                } else {
                    row += `<td class="score-cell score-missing">-</td>`;
                }
                
                // Add remaining evaluation types (skip pitching since we already added it)
                const remainingTypes = ['infield', 'outfield', 'batting', 'catching', 'speed'];
                remainingTypes.forEach(type => {
                    const score = player.scores[type];
                    if (score > 0) {
                        const cellClass = getScoreClass(score, scoreRanges);
                        row += `<td class="score-cell ${cellClass} clickable-cell" onclick="openEvaluationModal('${player.name}', '${type}')">${score.toFixed(1)}</td>`;
                    } else {
                        row += `<td class="score-cell score-missing">-</td>`;
                    }
                });

                // Overall average
                const overallClass = player.overall > 0 ? getScoreClass(player.overall, scoreRanges) : 'score-missing';
                row += `<td class="score-cell overall-avg ${overallClass}">${player.overall > 0 ? player.overall.toFixed(1) : '-'}</td>`;
                
                row += '</tr>';
                heatmapHTML += row;
            });

            document.getElementById('heatmapBody').innerHTML = heatmapHTML;
        }

        // Generate heatmap for all players
        function generateHeatmap() {
            if (!allEvaluations.length) {
                document.getElementById('heatmapBody').innerHTML = '<tr><td colspan="9" class="loading">No evaluations available</td></tr>';
                return;
            }

            // Get all unique players and build data structure
            const players = [...new Set(allEvaluations.map(eval => eval.player_name))].sort();
            const evalTypes = ['pitching', 'infield', 'outfield', 'batting', 'catching', 'speed'];

            heatmapData = players.map(player => {
                const playerEvals = allEvaluations.filter(eval => eval.player_name === player);
                const playerData = {
                    name: player,
                    scores: {},
                    velocity: 0,
                    overall: 0
                };
                
                let totalScore = 0;
                let evalCount = 0;

                evalTypes.forEach(type => {
                    const typeEvals = playerEvals.filter(eval => eval.evaluation_type === type);
                    
                    if (typeEvals.length > 0) {
                        const avgScore = typeEvals.reduce((sum, eval) => sum + eval.average_score, 0) / typeEvals.length;
                        playerData.scores[type] = avgScore;
                        totalScore += avgScore;
                        evalCount++;
                        
                        // Track velocity for pitching evaluations
                        if (type === 'pitching') {
                            const velocityEvals = typeEvals.filter(eval => eval.velocity > 0);
                            if (velocityEvals.length > 0) {
                                playerData.velocity = velocityEvals.reduce((sum, eval) => sum + eval.velocity, 0) / velocityEvals.length;
                            }
                        }
                    } else {
                        playerData.scores[type] = 0;
                    }
                });

                // Calculate overall average
                playerData.overall = evalCount > 0 ? totalScore / evalCount : 0;
                return playerData;
            });

            // Calculate dynamic score ranges for better visualization
            const scoreRanges = calculateDynamicRanges(heatmapData);
            
            updateLegend(scoreRanges);
            renderHeatmapTable(heatmapData, scoreRanges);
        }

        // Calculate dynamic score ranges based on actual data
        function calculateDynamicRanges(data) {
            const allScores = [];
            const allVelocities = [];
            
            // Collect all non-zero scores and velocities
            data.forEach(player => {
                Object.values(player.scores).forEach(score => {
                    if (score > 0) allScores.push(score);
                });
                if (player.overall > 0) allScores.push(player.overall);
                if (player.velocity > 0) allVelocities.push(player.velocity);
            });
            
            // Calculate score ranges
            let scoreRanges;
            if (allScores.length === 0) {
                scoreRanges = [2, 3.2, 4.4, 5.6, 6.8, 8];
            } else {
                allScores.sort((a, b) => a - b);
                const min = allScores[0];
                const max = allScores[allScores.length - 1];
                const range = max - min;
                
                scoreRanges = [
                    min,
                    min + range * 0.2,
                    min + range * 0.4,
                    min + range * 0.6,
                    min + range * 0.8,
                    max
                ];
            }
            
            // Calculate velocity ranges
            let velocityRanges;
            if (allVelocities.length === 0) {
                velocityRanges = [60, 65, 70, 75, 80, 85];
            } else {
                allVelocities.sort((a, b) => a - b);
                const vMin = allVelocities[0];
                const vMax = allVelocities[allVelocities.length - 1];
                const vRange = vMax - vMin;
                
                velocityRanges = [
                    vMin,
                    vMin + vRange * 0.2,
                    vMin + vRange * 0.4,
                    vMin + vRange * 0.6,
                    vMin + vRange * 0.8,
                    vMax
                ];
            }
            
            return { 
                score: { min: allScores[0] || 2, max: allScores[allScores.length - 1] || 8, ranges: scoreRanges },
                velocity: { min: allVelocities[0] || 60, max: allVelocities[allVelocities.length - 1] || 85, ranges: velocityRanges }
            };
        }

        // Get CSS class for score color coding using dynamic ranges
        function getScoreClass(score, rangeData) {
            if (!rangeData || score <= 0) return 'score-missing';
            
            const { ranges } = rangeData.score;
            if (score >= ranges[4]) return 'score-excellent';
            if (score >= ranges[3]) return 'score-good';
            if (score >= ranges[2]) return 'score-average';
            if (score >= ranges[1]) return 'score-below';
            return 'score-poor';
        }

        // Get CSS class for velocity color coding using dynamic ranges
        function getVelocityClass(velocity, rangeData) {
            if (!rangeData || velocity <= 0) return 'score-missing';
            
            const { ranges } = rangeData.velocity;
            if (velocity >= ranges[4]) return 'score-excellent';
            if (velocity >= ranges[3]) return 'score-good';
            if (velocity >= ranges[2]) return 'score-average';
            if (velocity >= ranges[1]) return 'score-below';
            return 'score-poor';
        }

        // Update legend with dynamic score ranges
        function updateLegend(rangeData) {
            const legendContainer = document.getElementById('heatmapLegend');
            if (!rangeData) {
                legendContainer.innerHTML = '<div class="legend-item"><span>No data available</span></div>';
                return;
            }
            
            const { ranges } = rangeData.score;
            const { ranges: vRanges } = rangeData.velocity;
            const legendItems = [
                { class: 'score-excellent', label: `Excellent (${ranges[4].toFixed(1)} - ${ranges[5].toFixed(1)})` },
                { class: 'score-good', label: `Good (${ranges[3].toFixed(1)} - ${ranges[4].toFixed(1)})` },
                { class: 'score-average', label: `Average (${ranges[2].toFixed(1)} - ${ranges[3].toFixed(1)})` },
                { class: 'score-below', label: `Below Avg (${ranges[1].toFixed(1)} - ${ranges[2].toFixed(1)})` },
                { class: 'score-poor', label: `Poor (${ranges[0].toFixed(1)} - ${ranges[1].toFixed(1)})` },
                { class: 'score-missing', label: 'Not Evaluated' }
            ];
            
            legendContainer.innerHTML = `
                <div style="margin-bottom: 10px;"><strong style="color: white;">Score Ranges:</strong></div>
                ${legendItems.map(item => `
                    <div class="legend-item">
                        <div class="legend-color ${item.class}"></div>
                        <span>${item.label}</span>
                    </div>
                `).join('')}
                <div style="margin: 15px 0 5px 0;"><strong style="color: white;">Velocity Ranges (MPH):</strong></div>
                <div class="legend-item">
                    <div class="legend-color score-excellent"></div>
                    <span>Excellent (${vRanges[4].toFixed(1)} - ${vRanges[5].toFixed(1)})</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color score-good"></div>
                    <span>Good (${vRanges[3].toFixed(1)} - ${vRanges[4].toFixed(1)})</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color score-average"></div>
                    <span>Average (${vRanges[2].toFixed(1)} - ${vRanges[3].toFixed(1)})</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color score-below"></div>
                    <span>Below Avg (${vRanges[1].toFixed(1)} - ${vRanges[2].toFixed(1)})</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color score-poor"></div>
                    <span>Poor (${vRanges[0].toFixed(1)} - ${vRanges[1].toFixed(1)})</span>
                </div>
            `;
        }

        // Open player profile from heatmap
        function openPlayerProfile(playerName) {
            // Switch to player profile tab
            switchView('player');
            
            // Set the player in the dropdown
            const playerSelect = document.getElementById('playerSelect');
            playerSelect.value = playerName;
            
            // Load the profile
            loadPlayerProfile();
        }

        // Open evaluation detail modal
        function openEvaluationModal(playerName, evaluationType) {
            const modal = document.getElementById('evaluationModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            // Set title
            modalTitle.textContent = `${playerName} - ${evaluationType.charAt(0).toUpperCase() + evaluationType.slice(1)}`;
            
            // Get evaluations for this player and type
            const playerEvals = allEvaluations.filter(eval => 
                eval.player_name === playerName && eval.evaluation_type === evaluationType
            );
            
            if (playerEvals.length === 0) {
                modalBody.innerHTML = '<p>No evaluations found for this player and skill area.</p>';
            } else {
                // Calculate average
                const avgScore = (playerEvals.reduce((sum, eval) => sum + eval.average_score, 0) / playerEvals.length).toFixed(1);
                
                let modalHTML = `
                    <div style="text-align: center; margin-bottom: 15px; padding: 10px; background: #2d2d2d; border-radius: 5px;">
                        <strong>Average Score: ${avgScore}/8</strong>
                        <br><small>${playerEvals.length} evaluation${playerEvals.length > 1 ? 's' : ''}</small>
                    </div>
                `;
                
                // Show each evaluation
                playerEvals.sort((a, b) => new Date(b.created_at) - new Date(a.created_at)).forEach((evaluation, index) => {
                    modalHTML += `
                        <div class="eval-detail">
                            <div class="eval-detail-header">
                                <span>Evaluator: ${evaluation.evaluator_name || 'Unknown'}</span>
                                <span>${evaluation.average_score.toFixed(1)}/8</span>
                            </div>
                            <div style="font-size: 12px; color: #999; margin-bottom: 8px;">
                                ${new Date(evaluation.created_at).toLocaleDateString()}
                            </div>
                            <div class="eval-criteria">
                    `;
                    
                    // Show specific ratings
                    if (evaluation.velocity) {
                        modalHTML += `<div>Velocity: ${evaluation.velocity} MPH</div>`;
                    }
                    
                    evaluation.ratings.forEach(rating => {
                        if (rating.time) {
                            modalHTML += `<div>${rating.criteria}: ${rating.time}s (${rating.rating}/8)</div>`;
                        } else {
                            modalHTML += `<div>${rating.criteria}: ${rating.rating}/8</div>`;
                        }
                    });
                    
                    modalHTML += `
                            </div>
                            ${evaluation.notes ? `<div style="margin-top: 8px; padding: 8px; background: #3d3d3d; border-radius: 3px; font-style: italic; color: #ccc;"><strong style="color: #FFD700;">Notes:</strong> ${evaluation.notes}</div>` : ''}
                        </div>
                    `;
                });
                
                modalBody.innerHTML = modalHTML;
            }
            
            // Show modal
            modal.style.display = 'block';
        }

        // Close modal
        function closeModal() {
            document.getElementById('evaluationModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('evaluationModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Setup real-time subscriptions
        function setupRealtimeSubscriptions() {
            if (!supabase) return;

            const subscription = supabase
                .channel('evaluations')
                .on('postgres_changes', 
                    { event: '*', schema: 'public', table: 'evaluations' }, 
                    (payload) => {
                        console.log('Real-time update:', payload);
                        loadEvaluations(); // Reload data when changes occur
                    }
                )
                .subscribe();

            console.log('Real-time subscription established');
        }

        // Initialize when page loads
        window.addEventListener('DOMContentLoaded', function() {
            // Load saved evaluator name
            loadEvaluatorName();
            
            // Initialize Supabase
            const initialized = initializeSupabase();
            
            if (initialized) {
                // Load existing evaluations
                loadEvaluations();
                
                // Setup real-time subscriptions
                setupRealtimeSubscriptions();
                
                console.log('‚úÖ Baseball Evaluation System with Supabase initialized successfully!');
            } else {
                console.log('‚ö†Ô∏è  Please configure your Supabase credentials to enable database functionality');
            }
            
            // Make sure all forms are hidden initially
            const forms = ['pitching', 'infield', 'outfield', 'batting', 'catching', 'speed'];
            forms.forEach(formId => {
                const form = document.getElementById(formId);
                if (form) {
                    form.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>